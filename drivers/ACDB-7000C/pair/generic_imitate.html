<script>
var options = {
	template: '../lib/pair/imitate.html',
	id: 'generic_imitate',
	body: 'deviceClasses.doorbell.views.generic_imitate.body',
	svg: '<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 17.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t width="403.695px" height="748.189px" viewBox="0 0 403.695 748.189" enable-background="new 0 0 403.695 748.189"\n\t xml:space="preserve" xmlns:pulse="-">\n<path d="M392.718,46.854c-2.203-9.442-7.15-25.856-15.521-29.698c-0.543-0.25-1.125-0.496-1.746-0.741\n\tc-1.902-0.968-3.866-1.561-5.747-1.904C337.918,5.461,253.891,0.22,201.833,0C149.518,0.221,64.855,5.519,33.472,14.661\n\tl-0.002-0.008c-1.654,0.398-3.148,0.896-4.5,1.484c-0.897,0.335-1.722,0.675-2.473,1.02c-8.369,3.841-13.316,20.255-15.52,29.698\n\tC1.937,85.584-0.004,318.514,0,374.095c-0.004,55.581,1.937,288.51,10.978,327.242c2.204,9.441,7.15,25.854,15.52,29.697\n\tc1.219,0.559,2.635,1.105,4.233,1.641c0.837,0.312,1.722,0.593,2.659,0.842l0.003-0.011c31.316,9.154,116.079,14.462,168.44,14.684\n\th0.03c52.442-0.223,137.387-5.546,168.586-14.727l0.004,0.012c0.166-0.052,0.333-0.106,0.501-0.162\n\tc2.441-0.735,4.535-1.495,6.243-2.278c8.37-3.841,13.317-20.255,15.521-29.697c9.038-38.722,10.981-271.659,10.978-327.242\n\tC403.699,318.512,401.756,85.574,392.718,46.854z M20.124,674.863c-1.222,9.681-2.157,17.129-2.761,22.396\n\tC8.917,652.591,7.083,428.424,7.087,374.095C7.083,319.596,8.927,94.204,17.441,50.523c0.454,3.43,1.083,7.891,1.88,13.525\n\tc3.089,21.815,7.757,54.783,8.493,76.695c2.562,76.223,3.86,154.5,3.86,232.66c0.007,78.833-1.291,157.543-3.856,233.955\n\tC26.178,626.901,22.821,653.491,20.124,674.863z M368.338,726.71l0.004,0.012c-29.209,8.648-113.242,14.153-166.494,14.381\n\tc-53.342-0.228-137.568-5.75-166.639-14.424l0.002-0.011c-0.141-0.038-0.281-0.076-0.42-0.116c-0.515-0.156-1.009-0.313-1.487-0.473\n\tc-6.059-2.17-9.716-6.787-9.647-20.061c0.014-2.669,1.628-15.459,3.498-30.269c2.71-21.47,6.083-48.189,7.732-67.89l0.01-0.177\n\tc2.571-76.517,3.871-155.341,3.864-234.282c0-78.238-1.3-156.596-3.864-232.897c-0.749-22.291-5.449-55.485-8.559-77.45\n\tc-1.433-10.122-2.671-18.863-2.681-20.885c-0.06-11.369,2.035-16.829,8.01-19.484c1.004-0.375,2.114-0.744,3.318-1.108\n\tc0.048-0.012,0.096-0.023,0.145-0.035l-0.002-0.008C64.127,12.845,148.471,7.313,201.833,7.087\n\tc56.275,0.238,146.944,6.372,170.94,15.884c3.459,2.019,7.33,6.866,7.267,19.199c-0.011,2.022-1.248,10.762-2.682,20.882\n\tc-3.11,21.966-7.811,55.161-8.559,77.453c-2.499,74.352-3.771,152.541-3.783,232.397c-0.014,80.683,1.26,159.675,3.783,234.783\n\tc0.748,22.294,5.448,55.489,8.559,77.456c1.434,10.118,2.671,18.857,2.682,20.879C380.099,717.462,376.271,724.23,368.338,726.71z\n\t M386.255,697.667c-0.454-3.429-1.083-7.889-1.88-13.521c-3.09-21.816-7.758-54.786-8.494-76.7\n\tc-2.521-75.027-3.792-153.939-3.779-234.543c0.012-79.777,1.284-157.887,3.779-232.16c0.736-21.913,5.404-54.881,8.493-76.697\n\tc0.798-5.633,1.427-10.094,1.88-13.523c8.512,43.671,10.358,269.071,10.355,323.573\n\tC396.612,428.596,394.766,653.995,386.255,697.667z"/>\n<g>\n\t<path d="M90.938,93.944c-10.357,0-18.784-8.427-18.784-18.784s8.427-18.784,18.784-18.784s18.784,8.426,18.784,18.784\n\t\tS101.296,93.944,90.938,93.944z M90.938,59.211c-8.794,0-15.949,7.154-15.949,15.949s7.155,15.949,15.949,15.949\n\t\ts15.949-7.155,15.949-15.949S99.733,59.211,90.938,59.211z"/>\n</g>\n<path pulse:initial="true" pulse:state="1" fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M36.293,723.31c13.239,3.907,37.817,7.159,65.639,9.576\n\tc33.644,2.922,71.5,4.58,99.915,4.701c28.415-0.121,66.272-1.779,99.915-4.701c27.747-2.41,52.265-5.651,65.53-9.544l-0.001-0.004\n\tc2.937-0.918,5.216-2.578,6.693-5.088c1.675-2.845,2.566-6.869,2.538-12.221c-0.009-1.691-1.132-9.626-2.661-20.424\n\tc-3.099-21.886-7.823-55.248-8.581-77.818c-1.259-37.469-2.205-76.096-2.837-115.348c-0.636-39.455-0.951-79.481-0.944-119.537\n\tc0.006-39.655,0.328-79.27,0.963-118.318c0.632-38.853,1.572-77.085,2.819-114.182c0.758-22.569,5.482-55.931,8.581-77.818\n\tc1.529-10.798,2.653-18.733,2.661-20.424c0.025-4.734-0.571-8.637-1.836-11.586c-0.892-2.081-2.145-3.62-3.779-4.547\n\tc-0.531-0.201-1.029-0.378-1.495-0.533c-0.647-0.215-1.433-0.457-2.352-0.723c-13.368-3.877-37.967-7.107-65.765-9.509\n\tc-33.529-2.897-71.168-4.54-99.449-4.661c-28.415,0.121-66.272,1.779-99.915,4.701c-27.822,2.417-52.4,5.668-65.639,9.576\n\tc-0.381,0.112-0.995,0.308-1.845,0.588c-0.659,0.216-1.122,0.371-1.387,0.461c-2.1,0.952-3.465,2.407-4.299,4.406\n\tc-1.187,2.842-1.616,6.791-1.59,11.826c0.009,1.691,1.132,9.627,2.661,20.424c3.099,21.886,7.823,55.248,8.581,77.818\n\tc1.301,38.706,2.266,77.54,2.908,116.483c0.658,39.93,0.981,78.76,0.981,116.516h-0.028c0.004,39.478-0.318,78.922-0.964,118.102\n\tc-0.646,39.167-1.612,78.004-2.898,116.283v0.36c-1.61,19.227-5.091,46.803-7.771,68.038c-1.946,15.422-3.459,27.4-3.471,29.844\n\tc-0.027,5.3,0.517,9.327,1.886,12.124c1.019,2.082,2.715,3.57,5.278,4.543l0.003-0.01c0.604,0.2,0.91,0.301,0.95,0.313\n\tC35.836,723.17,36.186,723.278,36.293,723.31 M115.391,75.16c0,6.752-2.737,12.865-7.162,17.291\n\tc-4.425,4.425-10.539,7.163-17.29,7.163c-6.752,0-12.865-2.737-17.291-7.163c-4.425-4.425-7.163-10.539-7.163-17.291\n\tc0-6.752,2.737-12.865,7.163-17.29c4.425-4.425,10.539-7.163,17.291-7.163c6.752,0,12.865,2.737,17.29,7.163\n\tC112.654,62.295,115.391,68.408,115.391,75.16z"/>\n</svg>\n',
	title: 'views.generic_imitate.title',
	svgWidth: '80vw',
	svgHeight: '70vh',
	initWithDeviceData: false,
	previous: true,
	next: false
};
Homey.setTitle(__(options.title || ''));
Homey.emit('init', options.id);
Homey.on('show_view', function(viewId){
	Homey.showView(viewId);
});
Homey.on('close', function(){
	Homey.close();
});
Homey.on('nextView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) + 1;
	if(viewIndex > 0 && viewIndex < viewsIds.length){
		Homey.showView(viewsIds[viewIndex]);
	}
});
Homey.on('previousView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) - 1;
	if(viewIndex >= 0){
		Homey.showView(viewsIds[viewIndex]);
	}
});
function nextView(){
	if(options.next){
		Homey.nextView();
	}else{
		Homey.emit('next');
	}
}
</script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<div class="centered-container">
	<div id="image-container"></div>
	<div id="body"><span class="content"></span></div>
	<div class="foundAnimation" id="foundBackground" style="display:none;"></div>
	<i class="fa fa-check-circle foundAnimation" id="found" style="display:none;" aria-hidden="true"></i>
</div>

<script>
	var idPrefix = '[data-id="' + options.id + '"] ';
	$(idPrefix + '#body > span').html(__(options.body));
	var $imageContainer = $(idPrefix + '#image-container');
	$imageContainer.css('width', options.svgWidth).css('height', options.svgHeight);

	$imageContainer.html(options.svg);
	$imageContainer.highlight();

	var found = false;
	Homey.on('frame', function (data) {
		if(!found) {
			found = true;
			Homey.emit('set_device', data, function (err, device) {
				if (err) {
					if((err.message || err) !== '433_generator.error.invalid_device') {
						Homey.alert(__(err.message || err));
					}
					found = false;
					return;
				}
				const dataKey = JSON.stringify(device.data);
				window.selected_devices = [ dataKey ];
				window.found_devices = {};
				window.found_devices[dataKey] = device;
				var $foundElems = $(idPrefix + '.foundAnimation');
				$foundElems.show();
				setTimeout(function () {
					$foundElems.addClass('fadeOut');
					setTimeout(nextView, 400);
				}, 500);
			});
		}
	});
</script>

<style>
	#found {
		z-index: 2;
		position: absolute;
		top: 20vh;
		left: 38vw;
		font-size: 30vh;
		color: #080;
		opacity: 1;
	}

	#foundBackground {
		z-index: 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		position: absolute;
		background-color: #FFF;
		opacity: 0.8;
	}

	.fadeOut {
		-webkit-transition: all 0.5s ease-in-out;
		-moz-transition: all 0.5s ease-in-out;
		-ms-transition: all 0.5s ease-in-out;
		-o-transition: all 0.5s ease-in-out;
		transition: all 0.5s ease-in-out;
		opacity: 0 !important;
	}
</style>